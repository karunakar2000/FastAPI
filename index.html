<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AWS Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 2rem;
        }
        #spinner {
            display: none;
        }
    </style>
</head>
<body>
    <h1 class="mb-4 text-primary">FastAPI Frontend Developed By @KARUNAKART</h1>

    <div id="spinner" class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>

    <div class="mb-3">
        <button onclick="fetchEC2()" class="btn btn-outline-primary">Get EC2 Info</button>
        <button onclick="fetchS3()" class="btn btn-outline-secondary">Get S3 Buckets</button>
        <button onclick="fetchVPCs()" class="btn btn-outline-success">Get VPCs</button>
        <button onclick="fetchCerts()" class="btn btn-outline-warning">Get Certificates</button>
    </div>

    <div id="output" class="mt-4"></div>

    <script>
        const showSpinner = () => document.getElementById('spinner').style.display = 'inline-block';
        const hideSpinner = () => document.getElementById('spinner').style.display = 'none';

        function fetchEC2() {
            showSpinner();
            fetch('/ec2').then(res => res.json()).then(data => {
                const rows = data.instances.map(i => `
                    <tr>
                        <td>${i.InstanceId}</td>
                        <td>${i.State}</td>
                        <td>${i.InstanceType}</td>
                        <td>${i.PublicIpAddress || 'N/A'}</td>
                        <td>
                            <button class="btn btn-sm btn-success" onclick="changeInstanceState('${i.InstanceId}', 'start')">Start</button>
                            <button class="btn btn-sm btn-danger" onclick="changeInstanceState('${i.InstanceId}', 'stop')">Stop</button>
                        </td>
                    </tr>`).join('');
                document.getElementById('output').innerHTML = `
                    <h3>EC2 Instances</h3>
                    <table class="table table-bordered">
                        <thead><tr><th>ID</th><th>State</th><th>Type</th><th>Public IP</th><th>Actions</th></tr></thead>
                        <tbody>${rows}</tbody>
                    </table>`;
                hideSpinner();
            });
        }

        function fetchS3() {
            showSpinner();
            fetch('/s3').then(res => res.json()).then(data => {
                const rows = data.buckets.map(b => `<tr><td>${b}</td></tr>`).join('');
                document.getElementById('output').innerHTML = `
                    <h3>S3 Buckets</h3>
                    <table class="table table-bordered">
                        <thead><tr><th>Name</th></tr></thead>
                        <tbody>${rows}</tbody>
                    </table>`;
                hideSpinner();
            });
        }

        function fetchVPCs() {
            showSpinner();
            fetch('/vpcs').then(res => res.json()).then(data => {
                const rows = data.vpcs.map(v => `<tr><td>${v.VpcId}</td><td>${v.CidrBlock}</td></tr>`).join('');
                document.getElementById('output').innerHTML = `
                    <h3>VPCs</h3>
                    <table class="table table-bordered">
                        <thead><tr><th>VPC ID</th><th>CIDR Block</th></tr></thead>
                        <tbody>${rows}</tbody>
                    </table>`;
                hideSpinner();
            });
        }

        function fetchCerts() {
            showSpinner();
            fetch('/certs').then(res => res.json()).then(data => {
                const rows = data.certificates.map(c => `
                    <tr>
                        <td>${c.DomainName}</td>
                        <td>${c.CertificateArn}</td>
                        <td>${new Date(c.CreatedAt).toLocaleString()}</td>
                    </tr>`).join('');
                document.getElementById('output').innerHTML = `
                    <h3>Certificates</h3>
                    <table class="table table-bordered">
                        <thead><tr><th>Domain</th><th>ARN</th><th>Created</th></tr></thead>
                        <tbody>${rows}</tbody>
                    </table>`;
                hideSpinner();
            });
        }

        function changeInstanceState(instanceId, action) {
            showSpinner();
            fetch(`/ec2/${action}?instance_id=${instanceId}`, { method: 'POST' })
                .then(res => res.json())
                .then(data => {
                    alert(data.message);
                    fetchEC2();
                });
        }
    </script>
</body>
</html>
